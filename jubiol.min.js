(function(){var a,h,g,c,j,b,e,k,f;var i=Object.prototype.hasOwnProperty,d=function(o,m){for(var l in m){if(i.call(m,l)){o[l]=m[l]}}function n(){this.constructor=o}n.prototype=m.prototype;o.prototype=new n;o.__super__=m.prototype;return o};f=(function(){function l(m,n){if(m==null){m=0}if(n==null){n=0}this.set(m,n)}l.prototype.set=function(m,n){if(m==null){m=0}if(n==null){n=0}this.x=m;this.y=n;return this};l.prototype.add=function(m){this.x+=m.x;this.y+=m.y;return this};l.prototype.sub=function(m){this.x-=m.x;this.y-=m.y;return this};l.prototype.scale=function(m){this.x*=m;this.y*=m;return this};l.prototype.div=function(m){this.x/=m;this.y/=m;return this};l.prototype.product=function(m){return this.x*m.x+this.y*m.y};l.prototype.length=function(){return Math.sqrt(this.x*this.x+this.y*this.y)};l.prototype.truncate=function(m){if(this.length()){this.scale(m/this.length())}return this};l.prototype.normalize=function(){return this.truncate(1)};l.prototype.angle=function(){return(180*Math.atan2(this.y,this.x))/Math.PI};l.prototype.rotate=function(o){var m,n;m=(o*Math.PI)/180;n=this.length();this.x=Math.sin(m)*this.y+Math.cos(m)*this.x;this.y=Math.cos(m)*this.y-Math.sin(m)*this.x;return this.truncate(n)};l.prototype.clone=function(){return new l(this.x,this.y)};l.prototype.reverse=function(){this.x*=-1;this.y*=-1;return this};return l})();Array.prototype._index=function(l){var m;if(l<0){m=this.length;return m+l}return l};Array.prototype.at=function(l){return this[this._index(l)]};Array.prototype.map=function(l){var n,m;return([].splice.apply(this,[0,this.length-0].concat(m=(function(){var q,p,o;o=[];for(q=0,p=this.length;q<p;q++){n=this[q];o.push(l(n))}return o}).call(this))),m)};Array.prototype.clone=function(){return this.dup()};Array.prototype.dup=function(){return this.slice(0,this.length)};Array.prototype.each=function(m){var l,n;for(l=0,n=this.length;0<=n?l<n:l>n;0<=n?l++:l--){m(this[l],l)}return this};Array.prototype.deleteAt=function(l){l=this._index(l);if(l>=this.length){return}return this.splice(l,1)};Array.prototype.deleteIf=function(m){var l;return this.replace((function(){var o,n;n=[];for(l=0,o=this.length;0<=o?l<o:l>o;0<=o?l++:l--){if(!m(this[l],l)){n.push(this[l])}}return n}).call(this))};Array.prototype.reject=function(l){var m;m=this.length;this.deleteIf(l);if(m===this.length){return}return this};Array.prototype.isEmpty=function(){return this.length===0};Array.prototype.isEql=function(l,o){var m,n;if(o==null){o=function(q,p){return q===p}}if(this.length!==l.length){return false}for(m=0,n=this.length;0<=n?m<n:m>n;0<=n?m++:m--){if(!o(this[m],l[m])){return false}}return true};Array.prototype.fill=function(o,p,l){var m,n;if(p==null){p=0}if(l==null){l=this.length-1}p=this._index(p);l=this._index(l);[].splice.apply(this,[p,l-p+1].concat(n=(function(){var q;q=[];for(m=p;p<=l?m<=l:m>=l;p<=l?m++:m--){q.push(o)}return q})())),n;return this};Array.prototype.first=function(){return this[0]};Array.prototype.last=function(){var l;l=this._index(-1);return this[l]};Array.prototype.uniq=function(p){var o,n,m,l;if(p==null){p=function(r,q){return r===q}}o=[];for(m=0,l=this.length;m<l;m++){n=this[m];if(!o.isInclude(n,p)){o.push(n)}}return this.replace(o)};Array.prototype.index=function(n,o){var l,m;if(o==null){o=function(q,p){return q===p}}for(l=0,m=this.length;0<=m?l<m:l>m;0<=m?l++:l--){if(o(this[l],n)){return l}}return};Array.prototype.indexes=function(){var n,o,m,l;l=[];for(o=0,m=arguments.length;o<m;o++){n=arguments[o];l.push(this.at(n))}return l};Array.prototype.rindex=function(n,o){var l,m;if(o==null){o=function(q,p){return q===p}}for(l=m=this.length;m<=0?l<0:l>0;m<=0?l++:l--){if(o(this[l],n)){return l}}return};Array.prototype.flatten=function(){return this.replace(this.reduce(function(m,l){return m.concat(l instanceof Array?l.flatten():l)},[]))};Array.prototype.transpose=function(){var p,o,n,m,l,q;m=this.isEmpty()?0:this.length;p=this.first() instanceof Array?this.first().length:0;if(!m||!p){return this}n=(function(){var r;r=[];for(o=0;0<=p?o<p:o>p;0<=p?o++:o--){r.push([])}return r})();for(l=0;0<=m?l<m:l>m;0<=m?l++:l--){for(q=0;0<=p?q<p:q>p;0<=p?q++:q--){n[q][l]=this[l][q]}}return this.replace(n)};Array.prototype.compact=function(){return this.deleteIf(function(l){return l===void 0})};Array.prototype.isInclude=function(o,p){var m,n,l;if(p==null){p=function(r,q){return r===q}}for(n=0,l=this.length;n<l;n++){m=this[n];if(p(m,o)){return true}}return false};Array.prototype.size=function(){return this.length};Array.prototype.swap=function(m,l){var n;m=this._index(m);l=this._index(l);n=this[m];this[m]=this[l];this[l]=n;return this};Array.prototype.shuffle=function(){var l,m;for(l=0,m=this.length;0<=m?l<m:l>m;0<=m?l++:l--){this.swap(l,Math.floor(Math.random()*this.length))}return this};Array.prototype.choice=function(){return this[Math.floor(Math.random()*this.length)]};Array.prototype.count=function(o,p){var l,m,n;if(p==null){p=function(r,q){return r===q}}m=0;for(l=0,n=this.length;0<=n?l<n:l>n;0<=n?l++:l--){if(p(this[l],o)){++m}}return m};Array.prototype.replace=function(l){var n,o,m;this.clear();for(o=0,m=l.length;o<m;o++){n=l[o];this.push(n)}return this};Array.prototype.nitems=function(){return this.clone().compact().size()};Array.prototype.insert=function(){var n,o,m,l,p;n=Array.prototype.slice.call(arguments,0,arguments.length);if(n.size()<=1){return this}m=this._index(n[0]);l=n.slice(1,this.length);for(o=0,p=l.length;0<=p?o<p:o>p;0<=p?o++:o--){this.splice(m+o,0,l[o])}return this};Array.prototype.clear=function(){var l;l=[];while(!this.isEmpty()){l.push(this.deleteAt(0))}return l};Array.prototype.max=function(m){var l;if(m==null){m=function(o,n){if(o===n){return 0}if(o<n){return -1}else{return 1}}}l=this.first();this.reduce(function(o,n){if(m(l,n)<0){return l=n}});return l};Array.prototype.min=function(m){var l;if(m==null){m=function(o,n){if(o===n){return 0}if(o<n){return -1}else{return 1}}}l=this.first();this.reduce(function(o,n){if(m(l,n)>=0){return l=n}});return l};k=(function(){function l(m,o,q,p,n){if(o==null){o=false}if(q==null){q=0}if(p==null){p=false}if(n==null){n=void 0}this.set(m);this._time=q;this._active=p;this._complete=n;this._repeat=o}l.prototype.set=function(m){if(m==null){m=0}this._max=m;return this};l.prototype.play=function(){this._active=true;return this};l.prototype.stop=function(){this._active=false;this._time=0;return this};l.prototype.pause=function(){this._active=false;return this};l.prototype.tick=function(){if(this._time<this._max&&this._active){++this._time;if(this._time===this._max){if(this._complete!=null){this._complete()}if(this._repeat){this._time=0}}}return this};l.prototype.now=function(){return this._time};l.prototype.setComplete=function(m){this._complete=m;return this};l.prototype.setRepeat=function(m){this._repeat=m;return this};return l})();enchant();h=(function(){l.prototype.config={WIDTH:640,HEIGHT:480,FPS:30,IMAGE_PATH:"resources/images/",IMAGES:["miku.gif","bullet.png","bullet1.png","font.png","kawaz.png"],SOUND_PATH:"resources/sounds/",SOUNDS:[]};function l(){var q,n,p,m,o;this.game=new Game(this.config.WIDTH,this.config.HEIGHT);this.game.fps=this.config.FPS;this.game.keybind(90,"a");l.game=this.game;l.config=this.config;o=this.config.IMAGES;for(p=0,m=o.length;p<m;p++){q=o[p];this.game.preload(""+this.config.IMAGE_PATH+q)}n=new c();this.game.onload=function(){n.setup();return this.pushScene(n)};this.game.start()}return l})();window.onload=function(){return new h()};e=(function(){d(l,Group);function l(){l.__super__.constructor.apply(this,arguments);this.player=new b(138,288);this.bullets=new Group();this.addChild(this.player);this.addChild(this.bullets);this.addEventListener("enterframe",this.update);this.count=0;this.total=0}l.prototype.update=function(){var o,q,n,p,m;this.popEnemy();p=this.bullets.childNodes;m=[];for(q=0,n=p.length;q<n;q++){o=p[q];m.push(this.player.within(o,10)?this.checkDeath():void 0)}return m};l.prototype.popEnemy=function(){var m;m=new a(Math.random()*h.config.WIDTH,0);if(m.red){++h.game.stage.total}return this.bullets.addChild(m)};l.prototype.checkDeath=function(){var m,n;n=Math.abs(this.total-this.count)/this.total;console.log(""+this.count+" "+this.total+" "+n);if(n<0.05){return console.log("OK")}else{console.log("NG");m=new Label("Game Over");m.x=150;m.y=200;m.width=500;m.font="64px Osaka";m.scaleX=5;m.scaleY=5;return h.game.currentScene.addChild(m)}};return l})();g=(function(){d(l,Sprite);function l(n,o,m,p){if(m==null){m=0}if(p==null){p=0}l.__super__.constructor.call(this,n,o);this.addEventListener("enterframe",this.update);this.x=m;this.y=p;this.v=new f()}l.prototype.update=function(m){this.x+=this.v.x;return this.y+=this.v.y};l.prototype.setImage=function(m){return this.image=h.game.assets[""+h.config.IMAGE_PATH+m]};l.prototype.setOpacity=function(q){var r,p,o,m,s,n;o=this.image.width;r=this.image.height;console.log("opacity");n=[];for(m=0;0<=o?m<o:m>o;0<=o?m++:m--){n.push((function(){var t;t=[];for(s=0;0<=r?s<r:s>r;0<=r?s++:s--){console.log(this.image.getPixel());p=this.image.getPixel();t.push(this.image.setPixel(m,s,p[0],p[1],p[2],q))}return t}).call(this))}return n};return l})();b=(function(){d(l,g);function l(m,n){if(m==null){m=0}if(n==null){n=0}l.__super__.constructor.call(this,42,32,m,n);this.setImage("miku.gif");this.speed=7;this.pressA=false}l.prototype.update=function(m){this.v.set(0,0);if(h.game.input.left){this.v.x=-1}else{if(h.game.input.right){this.v.x=1}}if(h.game.input.up){this.v.y=-1}else{if(h.game.input.down){this.v.y=1}}this.v.truncate(this.speed);l.__super__.update.apply(this,arguments);if(this.x>h.config.WIDTH-this.width){this.x=h.config.WIDTH-this.width}else{if(this.x<0){this.x=0}}if(this.y>h.config.HEIGHT-this.height){this.y=h.config.HEIGHT-this.height}else{if(this.y<0){this.y=0}}if(h.game.input.a){if(!this.pressA){++h.game.stage.count;this.pressA=true;return console.log(h.game.stage.count)}}else{return this.pressA=false}};return l})();a=(function(){d(l,g);function l(m,o){var n;if(m==null){m=0}if(o==null){o=0}l.__super__.constructor.call(this,12,12,m,o);n=Math.random()*100;if(n<5){this.setImage("bullet1.png");this.red=true}else{this.setImage("bullet.png");this.red=false}}l.prototype.update=function(m){this.v.y=10;l.__super__.update.apply(this,arguments);if(this.x<0||this.x>h.config.WIDTH||this.y<0||this.y>h.config.HEIGHT){return h.game.stage.bullets.removeChild(this)}};return l})();c=(function(){d(l,Scene);function l(){l.__super__.constructor.apply(this,arguments)}l.prototype.setup=function(){this.kawaz=new g(253,81);console.log("init");this.kawaz.setImage("kawaz.png");this.kawaz.x=193.5;this.kawaz.y=220;this.kawaz.opacity=0;this.addChild(this.kawaz);this.addEventListener("enterframe",this.update);this.timer=new k(180);this.timer.setComplete(function(){return h.game.replaceScene(new j())});return this.timer.play()};l.prototype.update=function(){this.timer.tick();if(this.timer.now()<60){return this.kawaz.opacity+=1/60}else{if(this.timer.now()>120){return this.kawaz.opacity-=1/60}}};return l})();j=(function(){d(l,Scene);function l(){l.__super__.constructor.apply(this,arguments);this.setup()}l.prototype.setup=function(){this.stage=new e();h.game.stage=this.stage;return this.addChild(this.stage)};return l})()}).call(this);