(function(){var a,h,f,b,d,i,e;var g=Object.prototype.hasOwnProperty,c=function(m,k){for(var j in k){if(g.call(k,j)){m[j]=k[j]}}function l(){this.constructor=m}l.prototype=k.prototype;m.prototype=new l;m.__super__=k.prototype;return m};e=(function(){function j(k,l){if(k==null){k=0}if(l==null){l=0}this.set(k,l)}j.prototype.set=function(k,l){if(k==null){k=0}if(l==null){l=0}this.x=k;this.y=l;return this};j.prototype.add=function(k){this.x+=k.x;this.y+=k.y;return this};j.prototype.sub=function(k){this.x-=k.x;this.y-=k.y;return this};j.prototype.scale=function(k){this.x*=k;this.y*=k;return this};j.prototype.div=function(k){this.x/=k;this.y/=k;return this};j.prototype.product=function(k){return this.x*k.x+this.y*k.y};j.prototype.length=function(){return Math.sqrt(this.x*this.x+this.y*this.y)};j.prototype.truncate=function(k){if(this.length()){this.scale(k/this.length())}return this};j.prototype.normalize=function(){return this.truncate(1)};j.prototype.angle=function(){return(180*Math.atan2(this.y,this.x))/Math.PI};j.prototype.rotate=function(m){var k,l;k=(m*Math.PI)/180;l=this.length();this.x=Math.sin(k)*this.y+Math.cos(k)*this.x;this.y=Math.cos(k)*this.y-Math.sin(k)*this.x;return this.truncate(l)};j.prototype.clone=function(){return new j(this.x,this.y)};j.prototype.reverse=function(){this.x*=-1;this.y*=-1;return this};return j})();Array.prototype._index=function(j){var k;if(j<0){k=this.length;return k+j}return j};Array.prototype.at=function(j){return this[this._index(j)]};Array.prototype.map=function(j){var l,k;return([].splice.apply(this,[0,this.length-0].concat(k=(function(){var o,n,m;m=[];for(o=0,n=this.length;o<n;o++){l=this[o];m.push(j(l))}return m}).call(this))),k)};Array.prototype.clone=function(){return this.dup()};Array.prototype.dup=function(){return this.slice(0,this.length)};Array.prototype.each=function(k){var j,l;for(j=0,l=this.length;0<=l?j<l:j>l;0<=l?j++:j--){k(this[j],j)}return this};Array.prototype.deleteAt=function(j){j=this._index(j);if(j>=this.length){return}return this.splice(j,1)};Array.prototype.deleteIf=function(k){var j;return this.replace((function(){var m,l;l=[];for(j=0,m=this.length;0<=m?j<m:j>m;0<=m?j++:j--){if(!k(this[j],j)){l.push(this[j])}}return l}).call(this))};Array.prototype.reject=function(j){var k;k=this.length;this.deleteIf(j);if(k===this.length){return}return this};Array.prototype.isEmpty=function(){return this.length===0};Array.prototype.isEql=function(j,m){var k,l;if(m==null){m=function(o,n){return o===n}}if(this.length!==j.length){return false}for(k=0,l=this.length;0<=l?k<l:k>l;0<=l?k++:k--){if(!m(this[k],j[k])){return false}}return true};Array.prototype.fill=function(m,n,j){var k,l;if(n==null){n=0}if(j==null){j=this.length-1}n=this._index(n);j=this._index(j);[].splice.apply(this,[n,j-n+1].concat(l=(function(){var o;o=[];for(k=n;n<=j?k<=j:k>=j;n<=j?k++:k--){o.push(m)}return o})())),l;return this};Array.prototype.first=function(){return this[0]};Array.prototype.last=function(){var j;j=this._index(-1);return this[j]};Array.prototype.uniq=function(n){var m,l,k,j;if(n==null){n=function(p,o){return p===o}}m=[];for(k=0,j=this.length;k<j;k++){l=this[k];if(!m.isInclude(l,n)){m.push(l)}}return this.replace(m)};Array.prototype.index=function(l,m){var j,k;if(m==null){m=function(o,n){return o===n}}for(j=0,k=this.length;0<=k?j<k:j>k;0<=k?j++:j--){if(m(this[j],l)){return j}}return};Array.prototype.indexes=function(){var l,m,k,j;j=[];for(m=0,k=arguments.length;m<k;m++){l=arguments[m];j.push(this.at(l))}return j};Array.prototype.rindex=function(l,m){var j,k;if(m==null){m=function(o,n){return o===n}}for(j=k=this.length;k<=0?j<0:j>0;k<=0?j++:j--){if(m(this[j],l)){return j}}return};Array.prototype.flatten=function(){return this.replace(this.reduce(function(k,j){return k.concat(j instanceof Array?j.flatten():j)},[]))};Array.prototype.transpose=function(){var n,m,l,k,j,o;k=this.isEmpty()?0:this.length;n=this.first() instanceof Array?this.first().length:0;if(!k||!n){return this}l=(function(){var p;p=[];for(m=0;0<=n?m<n:m>n;0<=n?m++:m--){p.push([])}return p})();for(j=0;0<=k?j<k:j>k;0<=k?j++:j--){for(o=0;0<=n?o<n:o>n;0<=n?o++:o--){l[o][j]=this[j][o]}}return this.replace(l)};Array.prototype.compact=function(){return this.deleteIf(function(j){return j===void 0})};Array.prototype.isInclude=function(m,n){var k,l,j;if(n==null){n=function(p,o){return p===o}}for(l=0,j=this.length;l<j;l++){k=this[l];if(n(k,m)){return true}}return false};Array.prototype.size=function(){return this.length};Array.prototype.swap=function(k,j){var l;k=this._index(k);j=this._index(j);l=this[k];this[k]=this[j];this[j]=l;return this};Array.prototype.shuffle=function(){var j,k;for(j=0,k=this.length;0<=k?j<k:j>k;0<=k?j++:j--){this.swap(j,Math.floor(Math.random()*this.length))}return this};Array.prototype.choice=function(){return this[Math.floor(Math.random()*this.length)]};Array.prototype.count=function(m,n){var j,k,l;if(n==null){n=function(p,o){return p===o}}k=0;for(j=0,l=this.length;0<=l?j<l:j>l;0<=l?j++:j--){if(n(this[j],m)){++k}}return k};Array.prototype.replace=function(j){var l,m,k;this.clear();for(m=0,k=j.length;m<k;m++){l=j[m];this.push(l)}return this};Array.prototype.nitems=function(){return this.clone().compact().size()};Array.prototype.insert=function(){var l,m,k,j,n;l=Array.prototype.slice.call(arguments,0,arguments.length);if(l.size()<=1){return this}k=this._index(l[0]);j=l.slice(1,this.length);for(m=0,n=j.length;0<=n?m<n:m>n;0<=n?m++:m--){this.splice(k+m,0,j[m])}return this};Array.prototype.clear=function(){var j;j=[];while(!this.isEmpty()){j.push(this.deleteAt(0))}return j};Array.prototype.max=function(k){var j;if(k==null){k=function(m,l){if(m===l){return 0}if(m<l){return -1}else{return 1}}}j=this.first();this.reduce(function(m,l){if(k(j,l)<0){return j=l}});return j};Array.prototype.min=function(k){var j;if(k==null){k=function(m,l){if(m===l){return 0}if(m<l){return -1}else{return 1}}}j=this.first();this.reduce(function(m,l){if(k(j,l)>=0){return j=l}});return j};i=(function(){function j(k,m,o,n,l){if(m==null){m=false}if(o==null){o=0}if(n==null){n=false}if(l==null){l=void 0}this.set(k);this._time=o;this._active=n;this._complete=l;this._repeat=m}j.prototype.set=function(k){if(k==null){k=0}this._max=k;return this};j.prototype.play=function(){this._active=true;return this};j.prototype.stop=function(){this._active=false;this._time=0;return this};j.prototype.pause=function(){this._active=false;return this};j.prototype.tick=function(){if(this._time<this._max&&this._active){++this._time;if(this._time===this._max){if(typeof complete==="undefined"||complete===null){this._complete()}if(this._repeat){this._time=0}}}return this};j.prototype.now=function(){return time};j.prototype.setComplete=function(k){var l;this._complete=(l=typeof k===Function)!=null?l:{func:void 0};return this};j.prototype.setRepeat=function(k){this._repeat=k;return this};return j})();enchant();f=(function(){j.prototype.config={WIDTH:640,HEIGHT:480,FPS:30,IMAGE_PATH:"resources/images/",IMAGES:["miku.gif","bullet.png","bullet1.png","font.png"],SOUND_PATH:"resources/sounds/",SOUNDS:[]};function j(){var n,m,k,l;this.game=new Game(this.config.WIDTH,this.config.HEIGHT);this.game.fps=this.config.FPS;this.game.keybind(90,"a");l=this.config.IMAGES;for(m=0,k=l.length;m<k;m++){n=l[m];this.game.preload(""+this.config.IMAGE_PATH+n)}this.game.onload=function(){this.stage=new d();j.game.stage=this.stage;return this.rootScene.addChild(this.stage)};this.game.start();j.game=this.game;j.config=this.config}return j})();window.onload=function(){return new f()};d=(function(){c(j,Group);function j(){j.__super__.constructor.apply(this,arguments);this.player=new b(138,288);this.bullets=new Group();this.addChild(this.player);this.addChild(this.bullets);this.addEventListener("enterframe",this.update);this.count=0;this.total=0}j.prototype.update=function(){var m,o,l,n,k;this.popEnemy();n=this.bullets.childNodes;k=[];for(o=0,l=n.length;o<l;o++){m=n[o];k.push(this.player.within(m,10)?this.checkDeath():void 0)}return k};j.prototype.popEnemy=function(){var k;k=new a(Math.random()*f.config.WIDTH,0);if(k.red){++f.game.stage.total}return this.bullets.addChild(k)};j.prototype.checkDeath=function(){var k,l;l=Math.abs(this.total-this.count)/this.total;console.log(""+this.count+" "+this.total+" "+l);if(l<0.05){return console.log("OK")}else{console.log("NG");k=new Label("Game Over");k.x=150;k.y=200;k.width=500;k.font="64px Osaka";k.scaleX=5;k.scaleY=5;return this.addChild(k)}};return j})();h=(function(){c(j,Sprite);function j(l,m,k,n){if(k==null){k=0}if(n==null){n=0}j.__super__.constructor.call(this,l,m);this.addEventListener("enterframe",this.update);this.x=k;this.y=n;this.v=new e()}j.prototype.update=function(k){this.x+=this.v.x;return this.y+=this.v.y};j.prototype.setImage=function(k){return this.image=f.game.assets[""+f.config.IMAGE_PATH+k]};j.prototype.setOpacity=function(o){var p,n,m,k,q,l;m=this.image.width;p=this.image.height;console.log("opacity");l=[];for(k=0;0<=m?k<m:k>m;0<=m?k++:k--){l.push((function(){var r;r=[];for(q=0;0<=p?q<p:q>p;0<=p?q++:q--){console.log(this.image.getPixel());n=this.image.getPixel();r.push(this.image.setPixel(k,q,n[0],n[1],n[2],o))}return r}).call(this))}return l};return j})();b=(function(){c(j,h);function j(k,l){if(k==null){k=0}if(l==null){l=0}j.__super__.constructor.call(this,42,32,k,l);this.setImage("miku.gif");this.speed=7;this.pressA=false}j.prototype.update=function(k){this.v.set(0,0);if(f.game.input.left){this.v.x=-1}else{if(f.game.input.right){this.v.x=1}}if(f.game.input.up){this.v.y=-1}else{if(f.game.input.down){this.v.y=1}}this.v.truncate(this.speed);j.__super__.update.apply(this,arguments);if(this.x>f.config.WIDTH-this.width){this.x=f.config.WIDTH-this.width}else{if(this.x<0){this.x=0}}if(this.y>f.config.HEIGHT-this.height){this.y=f.config.HEIGHT-this.height}else{if(this.y<0){this.y=0}}if(f.game.input.a){if(!this.pressA){++f.game.stage.count;this.pressA=true;return console.log(f.game.stage.count)}}else{return this.pressA=false}};return j})();a=(function(){c(j,h);function j(k,m){var l;if(k==null){k=0}if(m==null){m=0}j.__super__.constructor.call(this,12,12,k,m);l=Math.random()*100;if(l<5){this.setImage("bullet1.png");this.red=true}else{this.setImage("bullet.png");this.red=false}}j.prototype.update=function(k){this.v.y=10;j.__super__.update.apply(this,arguments);if(this.x<0||this.x>f.config.WIDTH||this.y<0||this.y>f.config.HEIGHT){return f.game.stage.bullets.removeChild(this)}};return j})()}).call(this);