(function(){var b,i,h,d,k,c,f,l,a,g;var j=Object.prototype.hasOwnProperty,e=function(p,n){for(var m in n){if(j.call(n,m)){p[m]=n[m]}}function o(){this.constructor=p}o.prototype=n.prototype;p.prototype=new o;p.__super__=n.prototype;return p};g=(function(){function m(n,o){if(n==null){n=0}if(o==null){o=0}this.set(n,o)}m.prototype.set=function(n,o){if(n==null){n=0}if(o==null){o=0}this.x=n;this.y=o;return this};m.prototype.add=function(n){this.x+=n.x;this.y+=n.y;return this};m.prototype.sub=function(n){this.x-=n.x;this.y-=n.y;return this};m.prototype.scale=function(o){this.x*=o;this.y*=o;return this};m.prototype.div=function(o){this.x/=o;this.y/=o;return this};m.prototype.product=function(n){return this.x*n.x+this.y*n.y};m.prototype.length=function(){return Math.sqrt(this.x*this.x+this.y*this.y)};m.prototype.truncate=function(o){if(this.length()){this.scale(o/this.length())}return this};m.prototype.normalize=function(){return this.truncate(1)};m.prototype.angle=function(){return(180*Math.atan2(this.y,this.x))/Math.PI};m.prototype.rotate=function(p){var n,o;n=(p*Math.PI)/180;o=this.length();this.x=Math.sin(n)*this.y+Math.cos(n)*this.x;this.y=Math.cos(n)*this.y-Math.sin(n)*this.x;return this.truncate(o)};m.prototype.clone=function(){return new m(this.x,this.y)};m.prototype.reverse=function(){this.x*=-1;this.y*=-1;return this};return m})();Array.prototype._index=function(m){var n;if(m<0){n=this.length;return n+m}return m};Array.prototype.at=function(m){return this[this._index(m)]};Array.prototype.map=function(m){var o,n;return([].splice.apply(this,[0,this.length-0].concat(n=(function(){var r,q,p;p=[];for(r=0,q=this.length;r<q;r++){o=this[r];p.push(m(o))}return p}).call(this))),n)};Array.prototype.clone=function(){return this.dup()};Array.prototype.dup=function(){return this.slice(0,this.length)};Array.prototype.each=function(n){var m,o;for(m=0,o=this.length;0<=o?m<o:m>o;0<=o?m++:m--){n(this[m],m)}return this};Array.prototype.deleteAt=function(m){m=this._index(m);if(m>=this.length){return}return this.splice(m,1)};Array.prototype.deleteIf=function(n){var m;return this.replace((function(){var p,o;o=[];for(m=0,p=this.length;0<=p?m<p:m>p;0<=p?m++:m--){if(!n(this[m],m)){o.push(this[m])}}return o}).call(this))};Array.prototype.reject=function(m){var n;n=this.length;this.deleteIf(m);if(n===this.length){return}return this};Array.prototype.isEmpty=function(){return this.length===0};Array.prototype.isEql=function(m,p){var n,o;if(p==null){p=function(r,q){return r===q}}if(this.length!==m.length){return false}for(n=0,o=this.length;0<=o?n<o:n>o;0<=o?n++:n--){if(!p(this[n],m[n])){return false}}return true};Array.prototype.fill=function(p,q,m){var n,o;if(q==null){q=0}if(m==null){m=this.length-1}q=this._index(q);m=this._index(m);[].splice.apply(this,[q,m-q+1].concat(o=(function(){var r;r=[];for(n=q;q<=m?n<=m:n>=m;q<=m?n++:n--){r.push(p)}return r})())),o;return this};Array.prototype.first=function(){return this[0]};Array.prototype.last=function(){var m;m=this._index(-1);return this[m]};Array.prototype.uniq=function(q){var p,o,n,m;if(q==null){q=function(s,r){return s===r}}p=[];for(n=0,m=this.length;n<m;n++){o=this[n];if(!p.isInclude(o,q)){p.push(o)}}return this.replace(p)};Array.prototype.index=function(o,p){var m,n;if(p==null){p=function(r,q){return r===q}}for(m=0,n=this.length;0<=n?m<n:m>n;0<=n?m++:m--){if(p(this[m],o)){return m}}return};Array.prototype.indexes=function(){var o,p,n,m;m=[];for(p=0,n=arguments.length;p<n;p++){o=arguments[p];m.push(this.at(o))}return m};Array.prototype.rindex=function(o,p){var m,n;if(p==null){p=function(r,q){return r===q}}for(m=n=this.length;n<=0?m<0:m>0;n<=0?m++:m--){if(p(this[m],o)){return m}}return};Array.prototype.flatten=function(){return this.replace(this.reduce(function(n,m){return n.concat(m instanceof Array?m.flatten():m)},[]))};Array.prototype.transpose=function(){var q,p,o,n,m,r;n=this.isEmpty()?0:this.length;q=this.first() instanceof Array?this.first().length:0;if(!n||!q){return this}o=(function(){var s;s=[];for(p=0;0<=q?p<q:p>q;0<=q?p++:p--){s.push([])}return s})();for(m=0;0<=n?m<n:m>n;0<=n?m++:m--){for(r=0;0<=q?r<q:r>q;0<=q?r++:r--){o[r][m]=this[m][r]}}return this.replace(o)};Array.prototype.compact=function(){return this.deleteIf(function(m){return m===void 0})};Array.prototype.isInclude=function(p,q){var n,o,m;if(q==null){q=function(s,r){return s===r}}for(o=0,m=this.length;o<m;o++){n=this[o];if(q(n,p)){return true}}return false};Array.prototype.size=function(){return this.length};Array.prototype.swap=function(n,m){var o;n=this._index(n);m=this._index(m);o=this[n];this[n]=this[m];this[m]=o;return this};Array.prototype.shuffle=function(){var m,n;for(m=0,n=this.length;0<=n?m<n:m>n;0<=n?m++:m--){this.swap(m,Math.floor(Math.random()*this.length))}return this};Array.prototype.choice=function(){return this[Math.floor(Math.random()*this.length)]};Array.prototype.count=function(p,q){var m,n,o;if(q==null){q=function(s,r){return s===r}}n=0;for(m=0,o=this.length;0<=o?m<o:m>o;0<=o?m++:m--){if(q(this[m],p)){++n}}return n};Array.prototype.replace=function(m){var o,p,n;this.clear();for(p=0,n=m.length;p<n;p++){o=m[p];this.push(o)}return this};Array.prototype.nitems=function(){return this.clone().compact().size()};Array.prototype.insert=function(){var o,p,n,m,q;o=Array.prototype.slice.call(arguments,0,arguments.length);if(o.size()<=1){return this}n=this._index(o[0]);m=o.slice(1,this.length);for(p=0,q=m.length;0<=q?p<q:p>q;0<=q?p++:p--){this.splice(n+p,0,m[p])}return this};Array.prototype.clear=function(){var m;m=[];while(!this.isEmpty()){m.push(this.deleteAt(0))}return m};Array.prototype.max=function(n){var m;if(n==null){n=function(p,o){if(p===o){return 0}if(p<o){return -1}else{return 1}}}m=this.first();this.reduce(function(p,o){if(n(m,o)<0){return m=o}});return m};Array.prototype.min=function(n){var m;if(n==null){n=function(p,o){if(p===o){return 0}if(p<o){return -1}else{return 1}}}m=this.first();this.reduce(function(p,o){if(n(m,o)>=0){return m=o}});return m};l=(function(){function m(n,p,r,q,o){if(p==null){p=false}if(r==null){r=0}if(q==null){q=false}if(o==null){o=void 0}this.set(n);this._time=r;this._active=q;this._complete=o;this._repeat=p}m.prototype.set=function(n){if(n==null){n=0}this._max=n;return this};m.prototype.play=function(){this._active=true;return this};m.prototype.stop=function(){this._active=false;this._time=0;return this};m.prototype.pause=function(){this._active=false;return this};m.prototype.reset=function(){this._time=0;return this};m.prototype.tick=function(){if(this._time<this._max&&this._active){++this._time;if(this._time===this._max){if(this._complete!=null){this._complete()}if(this._repeat){this._time=0}}}return this};m.prototype.now=function(){return this._time};m.prototype.setComplete=function(n){this._complete=n;return this};m.prototype.setRepeat=function(n){this._repeat=n;return this};m.prototype.isActive=function(){return this._active};m.prototype.isOver=function(){return this._time>=this._max};return m})();enchant();i=(function(){m.prototype.config={WIDTH:640,HEIGHT:480,FPS:30,FONT:"Osaka",IMAGE_PATH:"resources/images/",IMAGES:["miku.gif","bullet.png","bullet1.png","font.png","kawaz.png"],SOUND_PATH:"resources/sounds/",SOUNDS:[]};function m(){var r,o,q,n,p;this.game=new Game(this.config.WIDTH,this.config.HEIGHT);this.game.fps=this.config.FPS;this.game.keybind(90,"a");m.game=this.game;m.config=this.config;p=this.config.IMAGES;for(q=0,n=p.length;q<n;q++){r=p[q];this.game.preload(""+this.config.IMAGE_PATH+r)}o=new d();this.game.onload=function(){o.setup();return this.pushScene(o)};this.game.start()}return m})();window.onload=function(){return new i()};f=(function(){e(m,Group);function m(){m.__super__.constructor.apply(this,arguments);this.player=new c(138,288);this.addChild(this.player);this.count=0;this.total=0;this.checkTimer=new l(45);this.gameover=false}m.prototype.start=function(){this.bullets=new Group();this.addChild(this.bullets);this.addEventListener("enterframe",this.update);return this.pressA=false};m.prototype.update=function(r){var o,q,n,p;if(this.gameover){return}this.checkTimer.tick();if(!this.checkTimer.isActive()){this.popEnemy();this.player.update();p=this.bullets.childNodes.clone();for(q=0,n=p.length;q<n;q++){o=p[q];o.update();if(!this.player.invincibleTimer.isActive()&&this.player.within(o,10)){this.checkTimer.play();break}}}else{if(this.checkTimer.isOver()){this.checkDeath()}}if(i.game.input.a){if(!this.pressA){++i.game.stage.count;this.pressA=true;return console.log(i.game.stage.count)}}else{return this.pressA=false}};m.prototype.popEnemy=function(){var n;n=new b(Math.random()*i.config.WIDTH,0);if(n.red){++i.game.stage.total}return this.bullets.addChild(n)};m.prototype.checkDeath=function(){var n,o;o=Math.abs(this.total-this.count)/this.total;console.log(""+this.count+" "+this.total+" "+o);if(o<0.05){console.log("OK");this.player.invincibleTimer.play();return this.checkTimer.stop()}else{console.log("NG");this.parentNode.removeEventListener("enterframe");this.gameover=true;n=new Label("Game Over");n.x=150;n.y=200;n.width=500;n.font="64px "+i.config.FONT;n.scaleX=5;n.scaleY=5;return i.game.currentScene.addChild(n)}};return m})();h=(function(){e(m,Sprite);function m(o,p,n,q){if(n==null){n=0}if(q==null){q=0}m.__super__.constructor.call(this,o,p);this.removeEventListener("enterframe");this.x=n;this.y=q;this.v=new g()}m.prototype.update=function(n){this.x+=this.v.x;return this.y+=this.v.y};m.prototype.setImage=function(n){return this.image=i.game.assets[""+i.config.IMAGE_PATH+n]};return m})();c=(function(){e(m,h);function m(n,o){if(n==null){n=0}if(o==null){o=0}m.__super__.constructor.call(this,42,32,n,o);this.setImage("miku.gif");this.speed=7;this.pressA=false;this.invincibleTimer=new l(45);this.invincibleTimer.setComplete(function(){return this.stop()})}m.prototype.update=function(n){this.invincibleTimer.tick();this.opacity=0.5+0.5*Math.cos(this.invincibleTimer.now()*30*Math.PI/180);this.v.set(0,0);if(i.game.input.left){this.v.x=-1}else{if(i.game.input.right){this.v.x=1}}if(i.game.input.up){this.v.y=-1}else{if(i.game.input.down){this.v.y=1}}this.v.truncate(this.speed);m.__super__.update.apply(this,arguments);if(this.x>i.config.WIDTH-this.width){this.x=i.config.WIDTH-this.width}else{if(this.x<0){this.x=0}}if(this.y>i.config.HEIGHT-this.height){return this.y=i.config.HEIGHT-this.height}else{if(this.y<0){return this.y=0}}};return m})();b=(function(){e(m,h);function m(n,p){var o;if(n==null){n=0}if(p==null){p=0}m.__super__.constructor.call(this,12,12,n,p);o=Math.random()*100;if(o<5){this.setImage("bullet1.png");this.red=true}else{this.setImage("bullet.png");this.red=false}}m.prototype.update=function(n){this.v.y=10;m.__super__.update.apply(this,arguments);if(this.x<0||this.x>i.config.WIDTH||this.y<0||this.y>i.config.HEIGHT){return i.game.stage.bullets.removeChild(this)}};return m})();d=(function(){e(m,Scene);function m(){m.__super__.constructor.apply(this,arguments)}m.prototype.setup=function(){this.kawaz=new h(253,81);this.kawaz.setImage("kawaz.png");this.kawaz.x=193.5;this.kawaz.y=220;this.kawaz.opacity=0;this.addChild(this.kawaz);this.addEventListener("enterframe",this.update);this.timer=new l(180);this.timer.setComplete(function(){return i.game.replaceScene(new k())});return this.timer.play()};m.prototype.update=function(){if(i.game.input.a){i.game.replaceScene(new k())}this.timer.tick();if(this.timer.now()<60){return this.kawaz.opacity+=1/60}else{if(this.timer.now()>120){return this.kawaz.opacity-=1/60}}};return m})();a=(function(){e(m,Scene);function m(){m.__super__.constructor.apply(this,arguments)}false;return m})();k=(function(){e(m,Scene);function m(){m.__super__.constructor.apply(this,arguments);this.timer=new l(600);this.setup()}m.prototype.setup=function(){this.stage=new f();i.game.stage=this.stage;this.addChild(this.stage);this.addEventListener("enterframe",this.update);this.label=new Label("");return this.timer.play()};m.prototype.update=function(o){var n;this.timer.tick();if(this.timer.now()===30){this.label.text="Ready";this.label.x=220;this.label.y=200;this.label.font="64px "+i.config.FONT;return this.addChild(this.label)}else{if(this.timer.now()===60){this.label.text="GO!";this.label.x=250;return this.stage.start()}else{if((60<(n=this.timer.now())&&n<120)){this.label.y-=30;if(this.label.y<-100){return this.removeChild(this.label)}}}}};return m})()}).call(this);