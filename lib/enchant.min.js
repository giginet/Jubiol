if(typeof Object.defineProperty!="function"){Object.defineProperty=function(a,c,b){if("value" in b){a[c]=b.value}if("get" in b){a.__defineGetter__(c,b.get)}if("set" in b){a.__defineSetter__(c,b.set)}return a}}if(typeof Object.defineProperties!="function"){Object.defineProperties=function(b,a){for(var c in a){if(a.hasOwnProperty(c)){Object.defineProperty(b,c,a[c])}}return b}}if(typeof Object.create!="function"){Object.create=function(a,c){function b(){}b.prototype=a;var d=new b();if(c!=null){Object.defineProperties(d,c)}return d}}if(typeof Object.getPrototypeOf!="function"){Object.getPrototypeOf=function(a){return a.__proto__}}var enchant=function(b){if(b!=null){if(!(b instanceof Array)){b=Array.prototype.slice.call(arguments)}b=b.filter(function(c){return[c].join()})}(function a(f,g){var d=[];for(var h in f){if(f.hasOwnProperty(h)){if(typeof f[h]=="function"){window[h]=f[h]}else{if(Object.getPrototypeOf(f[h])==Object.prototype){if(b==null){d.push(h)}else{e=b.indexOf(g+h);if(e!=-1){d.push(h);b.splice(e,1)}}}}}}for(var e=0,c=d.length;e<c;e++){a(f[d[e]],g+d[e]+".")}})(enchant,"");if(b!=null&&b.length){throw new Error("Cannot load module: "+b.join(", "))}};(function(){var e=(function(){var f=navigator.userAgent;if(f.indexOf("Opera")!=-1){return"O"}else{if(f.indexOf("MSIE")!=-1){return"ms"}else{if(f.indexOf("WebKit")!=-1){return"webkit"}else{if(navigator.product=="Gecko"){return"Moz"}else{return""}}}}})();var d=(function(){var f=document.createElement("div");f.setAttribute("ontouchstart","return");return typeof f.ontouchstart=="function"})();var b=(function(){if(navigator.userAgent.indexOf("iPhone")!=-1&&window.devicePixelRatio==2){var f=document.querySelector('meta[name="viewport"]');if(f==null){f=document.createElement("meta");document.head.appendChild(f)}f.setAttribute("content","width=640px");return true}else{return false}})();var c;enchant.Class=function(g,f){return enchant.Class.create(g,f)};enchant.Class.create=function(i,f){if(arguments.length==0){return enchant.Class.create(Object,f)}else{if(arguments.length==1&&typeof arguments[0]!="function"){return enchant.Class.create(Object,arguments[0])}}for(var h in f){if(f.hasOwnProperty(h)){if(Object.getPrototypeOf(f[h])==Object.prototype){if(!("enumerable" in f[h])){f[h].enumerable=true}}else{f[h]={value:f[h],enumerable:true,writable:true}}}}var g=function(){if(this instanceof g){g.prototype.initialize.apply(this,arguments)}else{return new g()}};g.prototype=Object.create(i.prototype,f);g.prototype.constructor=g;if(g.prototype.initialize==null){g.prototype.initialize=function(){i.apply(this,arguments)}}return g};enchant.Event=enchant.Class.create({initialize:function(f){this.type=f;this.target=null;this.x=0;this.y=0;this.localX=0;this.localY=0},_initPosition:function(g,f){this.x=this.localX=(g-c._pageX)/c.scale;this.y=this.localY=(f-c._pageY)/c.scale}});enchant.Event.LOAD="load";enchant.Event.PROGRESS="progress";enchant.Event.ENTER_FRAME="enterframe";enchant.Event.EXIT_FRAME="exitframe";enchant.Event.ENTER="enter";enchant.Event.EXIT="exit";enchant.Event.ADDED="added";enchant.Event.ADDED_TO_SCENE="addedtoscene";enchant.Event.REMOVED="removed";enchant.Event.REMOVED_FROM_SCENE="removedfromscene";enchant.Event.TOUCH_START="touchstart";enchant.Event.TOUCH_MOVE="touchmove";enchant.Event.TOUCH_END="touchend";enchant.Event.RENDER="render";enchant.Event.INPUT_START="inputstart";enchant.Event.INPUT_CHANGE="inputchange";enchant.Event.INPUT_END="inputend";enchant.Event.LEFT_BUTTON_DOWN="leftbuttondown";enchant.Event.LEFT_BUTTON_UP="leftbuttonup";enchant.Event.RIGHT_BUTTON_DOWN="rightbuttondown";enchant.Event.RIGHT_BUTTON_UP="rightbuttonup";enchant.Event.UP_BUTTON_DOWN="upbuttondown";enchant.Event.UP_BUTTON_UP="upbuttonup";enchant.Event.DOWN_BUTTON_DOWN="downbuttondown";enchant.Event.DOWN_BUTTON_UP="downbuttonup";enchant.Event.A_BUTTON_DOWN="abuttondown";enchant.Event.A_BUTTON_UP="abuttonup";enchant.Event.B_BUTTON_DOWN="bbuttondown";enchant.Event.B_BUTTON_UP="bbuttonup";enchant.EventTarget=enchant.Class.create({initialize:function(){this._listeners={}},addEventListener:function(g,h){var f=this._listeners[g];if(f==null){this._listeners[g]=[h]}else{if(f.indexOf(h)==-1){f.unshift(h)}}},removeEventListener:function(h,j){var g=this._listeners[h];if(g!=null){var f=g.indexOf(j);if(f!=-1){g.splice(f,1)}}},clearEventListener:function(f){if(f!=null){delete this._listeners[f]}else{this._listeners={}}},dispatchEvent:function(j){j.target=this;j.localX=j.x-this._offsetX;j.localY=j.y-this._offsetY;if(this["on"+j.type]!=null){this["on"+j.type]()}var h=this._listeners[j.type];if(h!=null){h=h.slice();for(var g=0,f=h.length;g<f;g++){h[g].call(this,j)}}}});enchant.Game=enchant.Class.create(enchant.EventTarget,{initialize:function(j,t){enchant.EventTarget.call(this);var p=true;if(c){p=false;c.stop()}c=enchant.Game.instance=this;this.width=j||320;this.height=t||320;this.scale=1;var q=document.getElementById("enchant-stage");if(!q){q=document.createElement("div");q.id="enchant-stage";q.style.width=window.innerWidth+"px";q.style.height=window.innerHeight+"px";q.style.position="absolute";if(document.body.firstChild){document.body.insertBefore(q,document.body.firstChild)}else{document.body.appendChild(q)}this.scale=Math.min(window.innerWidth/this.width,window.innerHeight/this.height);this._pageX=0;this._pageY=0}else{var h=window.getComputedStyle(q);j=parseInt(h.width);t=parseInt(h.height);if(j&&t){this.scale=Math.min(j/this.width,t/this.height)}else{q.style.width=this.width+"px";q.style.height=this.height+"px"}while(q.firstChild){q.removeChild(q.firstChild)}q.style.position="relative";var g=q.getBoundingClientRect();this._pageX=Math.round(window.scrollX+g.left);this._pageY=Math.round(window.scrollY+g.top)}if(!this.scale){this.scale=1}q.style.fontSize="12px";q.style.webkitTextSizeAdjust="none";this._element=q;this.fps=30;this.frame=0;this.ready=null;this.running=false;this.assets={};var n=this._assets=[];(function k(v){if(v.assets instanceof Array){[].push.apply(n,v.assets)}for(var w in v){if(v.hasOwnProperty(w)){if(Object.getPrototypeOf(v[w])==Object.prototype){k(v[w])}}}})(enchant);this._scenes=[];this.currentScene=null;this.rootScene=new enchant.Scene();this.pushScene(this.rootScene);this.loadingScene=new enchant.Scene();this.loadingScene.backgroundColor="#000";var u=this.width*0.9|0;var s=this.width*0.3|0;var m=u*0.05|0;var o=new enchant.Sprite(u,s);o.x=(this.width-u)/2;o.y=(this.height-s)/2;var l=new enchant.Surface(u,s);l.context.fillStyle="#fff";l.context.fillRect(0,0,u,s);l.context.fillStyle="#000";l.context.fillRect(m,m,u-m*2,s-m*2);o.image=l;var f=0,i=0;this.addEventListener("progress",function(v){f=v.loaded/v.total});o.addEventListener("enterframe",function(){i*=0.9;i+=f*0.1;l.context.fillStyle="#fff";l.context.fillRect(m,0,(u-m*2)*i,s)});this.loadingScene.addChild(o);this._mousedownID=0;this._surfaceID=0;this._soundID=0;this._intervalID=null;this.input={};this._keybind={};this.keybind(37,"left");this.keybind(38,"up");this.keybind(39,"right");this.keybind(40,"down");var r=0;["left","right","up","down","a","b"].forEach(function(v){this.addEventListener(v+"buttondown",function(w){if(!this.input[v]){this.input[v]=true;this.dispatchEvent(new enchant.Event((r++)?"inputchange":"inputstart"))}this.currentScene.dispatchEvent(w)});this.addEventListener(v+"buttonup",function(w){if(this.input[v]){this.input[v]=false;this.dispatchEvent(new enchant.Event((--r)?"inputchange":"inputend"))}this.currentScene.dispatchEvent(w)})},this);if(p){document.addEventListener("keydown",function(w){c.dispatchEvent(new enchant.Event("keydown"));if((37<=w.keyCode&&w.keyCode<=40)||w.keyCode==32){w.preventDefault();w.stopPropagation()}if(!c.running){return}var v=c._keybind[w.keyCode];if(v){var w=new enchant.Event(v+"buttondown");c.dispatchEvent(w)}},true);document.addEventListener("keyup",function(w){if(!c.running){return}var v=c._keybind[w.keyCode];if(v){var w=new enchant.Event(v+"buttonup");c.dispatchEvent(w)}},true);if(d){document.addEventListener("touchstart",function(v){v.preventDefault()},true);document.addEventListener("touchmove",function(v){v.preventDefault();if(!c.running){v.stopPropagation()}},true);document.addEventListener("touchend",function(v){v.preventDefault();if(!c.running){v.stopPropagation()}},true)}else{document.addEventListener("mousedown",function(v){v.preventDefault();c._mousedownID++;if(!c.running){v.stopPropagation()}},true);document.addEventListener("mousemove",function(v){v.preventDefault();if(!c.running){v.stopPropagation()}},true);document.addEventListener("mouseup",function(v){v.preventDefault();if(!c.running){v.stopPropagation()}},true)}}},preload:function(f){if(!(f instanceof Array)){f=Array.prototype.slice.call(arguments)}[].push.apply(this._assets,f)},load:function(h,i){if(i==null){i=function(){}}var f=h.match(/\.\w+$/)[0];if(f){f=f.slice(1).toLowerCase()}switch(f){case"jpg":case"gif":case"png":c.assets[h]=enchant.Surface.load(h);c.assets[h].addEventListener("load",i);break;case"mp3":case"aac":case"m4a":case"wav":case"ogg":c.assets[h]=enchant.Sound.load(h,"audio/"+f);c.assets[h].addEventListener("load",i);break;default:var g=new XMLHttpRequest();g.open("GET",h,true);g.onreadystatechange=function(k){if(g.readyState==4){if(g.status!=200){throw new Error("Cannot load an asset: "+h)}var j=g.getResponseHeader("Content-Type")||"";if(j.match(/^image/)){c.assets[h]=enchant.Surface.load(h);c.assets[h].addEventListener("load",i)}else{if(j.match(/^audio/)){c.assets[h]=enchant.Sound.load(h,j);c.assets[h].addEventListener("load",i)}else{c.assets[asset]=g.responseText;i()}}}};g.send(null)}},start:function(){if(this._intervalID){window.clearInterval(this._intervalID)}else{if(this._assets.length){if(enchant.Sound.enabledInMobileSafari&&!c._touched&&e=="webkit"&&d){var l=new Scene();l.backgroundColor="#000";var p=Math.round(c.width/10);var n=new Sprite(c.width,p);n.y=(c.height-p)/2;n.image=new Surface(c.width,p);n.image.context.fillStyle="#fff";n.image.context.font=(p-1)+"px bold Helvetica,Arial,sans-serif";var f=n.image.context.measureText("Touch to Start").width;n.image.context.fillText("Touch to Start",(c.width-f)/2,p-1);l.addChild(n);document.addEventListener("touchstart",function(){c._touched=true;c.removeScene(l);c.start()},true);c.pushScene(l);return}var g={};var h=this._assets.filter(function(i){return i in g?false:g[i]=true});var k=0;for(var j=0,m=h.length;j<m;j++){this.load(h[j],function(){var i=new enchant.Event("progress");i.loaded=++k;i.total=m;c.dispatchEvent(i);if(k==m){c.removeScene(c.loadingScene);c.dispatchEvent(new enchant.Event("load"))}})}this.pushScene(this.loadingScene)}else{this.dispatchEvent(new enchant.Event("load"))}}this.currentTime=Date.now();this._intervalID=window.setInterval(function(){c._tick()},1000/this.fps);this.running=true},_tick:function(){var h=Date.now();var j=new enchant.Event("enterframe");j.elapsed=h-this.currentTime;this.currentTime=h;var f=this.currentScene.childNodes.slice();var g=Array.prototype.push;while(f.length){var i=f.pop();i.dispatchEvent(j);if(i.childNodes){g.apply(f,i.childNodes)}}this.currentScene.dispatchEvent(j);this.dispatchEvent(j);this.dispatchEvent(new enchant.Event("exitframe"));this.frame++},stop:function(){if(this._intervalID){window.clearInterval(this._intervalID);this._intervalID=null}this.running=false},pause:function(){if(this._intervalID){window.clearInterval(this._intervalID);this._intervalID=null}},pushScene:function(f){this._element.appendChild(f._element);if(this.currentScene){this.currentScene.dispatchEvent(new enchant.Event("exit"))}this.currentScene=f;this.currentScene.dispatchEvent(new enchant.Event("enter"));return this._scenes.push(f)},popScene:function(){if(this.currentScene==this.rootScene){return}this._element.removeChild(this.currentScene._element);this.currentScene.dispatchEvent(new enchant.Event("exit"));this.currentScene=this._scenes[this._scenes.length-2];this.currentScene.dispatchEvent(new enchant.Event("enter"));return this._scenes.pop()},replaceScene:function(f){this.popScene();return this.pushScene(f)},removeScene:function(g){if(this.currentScene==g){return this.popScene()}else{var f=this._scenes.indexOf(g);if(f!=-1){this._scenes.splice(f,1);this._element.removeChild(g._element);return g}}},keybind:function(g,f){this._keybind[g]=f}});enchant.Game.instance=null;enchant.Node=enchant.Class.create(enchant.EventTarget,{initialize:function(){enchant.EventTarget.call(this);this._x=0;this._y=0;this._offsetX=0;this._offsetY=0;this.parentNode=null;this.scene=null;this.addEventListener("touchstart",function(f){if(this.parentNode&&this.parentNode!=this.scene){this.parentNode.dispatchEvent(f)}});this.addEventListener("touchmove",function(f){if(this.parentNode&&this.parentNode!=this.scene){this.parentNode.dispatchEvent(f)}});this.addEventListener("touchend",function(f){if(this.parentNode&&this.parentNode!=this.scene){this.parentNode.dispatchEvent(f)}})},moveTo:function(f,g){this._x=f;this._y=g;this._updateCoordinate()},moveBy:function(f,g){this._x+=f;this._y+=g;this._updateCoordinate()},x:{get:function(){return this._x},set:function(f){this._x=f;this._updateCoordinate()}},y:{get:function(){return this._y},set:function(f){this._y=f;this._updateCoordinate()}},_updateCoordinate:function(){if(this.parentNode){this._offsetX=this.parentNode._offsetX+this._x;this._offsetY=this.parentNode._offsetY+this._y}else{this._offsetX=this._x;this._offsetY=this._y}},remove:function(){if(this._listener){this.clearEventListener()}if(this.parentNode){this.removeChild(this)}}});enchant.Entity=enchant.Class.create(enchant.Node,{initialize:function(){enchant.Node.call(this);this._element=document.createElement("div");this._style=this._element.style;this._style.position="absolute";this._width=0;this._height=0;this._backgroundColor=null;this._opacity=1;this._visible=true;this._buttonMode=null;this.buttonMode=null;this.buttonPressed=false;this.addEventListener("touchstart",function(){if(!this.buttonMode){return}this.buttonPressed=true;var h=new Event(this.buttonMode+"buttondown");this.dispatchEvent(h);c.dispatchEvent(h)});this.addEventListener("touchend",function(){if(!this.buttonMode){return}this.buttonPressed=false;var h=new Event(this.buttonMode+"buttonup");this.dispatchEvent(h);c.dispatchEvent(h)});var g=this;var f=function(){g.dispatchEvent(new enchant.Event("render"))};this.addEventListener("addedtoscene",function(){f();c.addEventListener("exitframe",f)});this.addEventListener("removedfromscene",function(){c.removeEventListener("exitframe",f)});this.addEventListener("render",function(){if(this._offsetX!=this._previousOffsetX){this._style.left=this._offsetX+"px"}if(this._offsetY!=this._previousOffsetY){this._style.top=this._offsetY+"px"}this._previousOffsetX=this._offsetX;this._previousOffsetY=this._offsetY});var g=this;if(d){this._element.addEventListener("touchstart",function(l){var k=l.touches;for(var j=0,h=k.length;j<h;j++){l=new enchant.Event("touchstart");l.identifier=k[j].identifier;l._initPosition(k[j].pageX,k[j].pageY);g.dispatchEvent(l)}},false);this._element.addEventListener("touchmove",function(l){var k=l.touches;for(var j=0,h=k.length;j<h;j++){l=new enchant.Event("touchmove");l.identifier=k[j].identifier;l._initPosition(k[j].pageX,k[j].pageY);g.dispatchEvent(l)}},false);this._element.addEventListener("touchend",function(l){var k=l.changedTouches;for(var j=0,h=k.length;j<h;j++){l=new enchant.Event("touchend");l.identifier=k[j].identifier;l._initPosition(k[j].pageX,k[j].pageY);g.dispatchEvent(l)}},false)}else{this._element.addEventListener("mousedown",function(i){var h=i.pageX;var j=i.pageY;i=new enchant.Event("touchstart");i.identifier=c._mousedownID;i._initPosition(h,j);g.dispatchEvent(i);g._mousedown=true},false);c._element.addEventListener("mousemove",function(i){if(!g._mousedown){return}var h=i.pageX;var j=i.pageY;i=new enchant.Event("touchmove");i.identifier=c._mousedownID;i._initPosition(h,j);g.dispatchEvent(i)},false);c._element.addEventListener("mouseup",function(i){if(!g._mousedown){return}var h=i.pageX;var j=i.pageY;i=new enchant.Event("touchend");i.identifier=c._mousedownID;i._initPosition(h,j);g.dispatchEvent(i);g._mousedown=false},false)}},id:{get:function(){return this._element.id},set:function(f){this._element.id=f}},className:{get:function(){return this._element.className},set:function(f){this._element.className=f}},width:{get:function(){return this._width},set:function(f){this._style.width=(this._width=f)+"px"}},height:{get:function(){return this._height},set:function(f){this._style.height=(this._height=f)+"px"}},backgroundColor:{get:function(){return this._backgroundColor},set:function(f){this._element.style.backgroundColor=this._backgroundColor=f}},opacity:{get:function(){return this._opacity},set:function(f){this._style.opacity=this._opacity=f}},visible:{get:function(){return this._visible},set:function(f){if(this._visible=f){this._style.display="block"}else{this._style.display="none"}}},touchEnabled:{get:function(){return this._touchEnabled},set:function(f){if(this._touchEnabled=f){this._style.pointerEvents="all"}else{this._style.pointerEvents="none"}}},intersect:function(f){return this.x<f.x+f.width&&f.x<this.x+this.width&&this.y<f.y+f.height&&f.y<this.y+this.height},within:function(f,h){if(h==null){h=(this.width+this.height+f.width+f.height)/4}var g;return(g=this.x-f.x+(this.width-f.width)/2)*g+(g=this.y-f.y+(this.height-f.height)/2)*g<h*h}});enchant.Sprite=enchant.Class.create(enchant.Entity,{initialize:function(g,f){enchant.Entity.call(this);this.width=g;this.height=f;this._scaleX=1;this._scaleY=1;this._rotation=0;this._dirty=false;this._image=null;this._frame=0;this._style.overflow="hidden";this.addEventListener("render",function(){if(this._dirty){this._style[e+"Transform"]=["rotate(",this._rotation,"deg)","scale(",this._scaleX,",",this._scaleY,")"].join("");this._dirty=false}})},image:{get:function(){return this._image},set:function(h){if(h==this._image){return}if(this._image!=null){if(this._image.css){this._style.backgroundImage=""}else{if(this._element.firstChild){this._element.removeChild(this._element.firstChild);if(this._dirtyListener){this.removeEventListener("render",this._dirtyListener);this._dirtyListener=null}else{this._image._parent=null}}}}if(h!=null){if(h._css){this._style.backgroundImage=h._css}else{if(h._parent){var f=document.createElement("canvas");var g=f.getContext("2d");f.width=h.width;f.height=h.height;g.drawImage(h._element,0,0);this._dirtyListener=function(){if(h._dirty){g.drawImage(h._element);h._dirty=false}};this.addEventListener("render",this._dirtyListener);this._element.appendChild(f)}else{h._parent=this;this._element.appendChild(h._element)}}}this._image=h;this.frame=this.frame}},frame:{get:function(){return this._frame},set:function(h){this._frame=h;if(this._image!=null){var g=this._image.width/this._width|0;if(this._image._css){this._style.backgroundPosition=[-(h%g)*this._width,"px ",-(h/g|0)*this._height,"px"].join("")}else{if(this._element.firstChild){var f=this._element.firstChild.style;f.left=-(h%g)*this._width+"px";f.top=-(h/g|0)*this._height+"px"}}}}},scale:function(f,g){if(g==null){g=f}this._scaleX*=f;this._scaleY*=g;this._dirty=true},rotate:function(f){this._rotation+=f;this._dirty=true},scaleX:{get:function(){return this._scaleX},set:function(f){this._scaleX=f;this._dirty=true}},scaleY:{get:function(){return this._scaleY},set:function(f){this._scaleY=f;this._dirty=true}},rotation:{get:function(){return this._rotation},set:function(f){this._rotation=f;this._dirty=true}}});enchant.Label=enchant.Class.create(enchant.Entity,{initialize:function(f){enchant.Entity.call(this);this.width=300;this.text=f},text:{get:function(){return this._element.innerHTML},set:function(f){this._element.innerHTML=f}},font:{get:function(){return this._style.font},set:function(f){this._style.font=f}},color:{get:function(){return this._style.color},set:function(f){this._style.color=f}}});enchant.Map=enchant.Class.create(enchant.Entity,{initialize:function(h,f){enchant.Entity.call(this);var g=document.createElement("canvas");if(b&&c.scale==2){g.width=c.width*2;g.height=c.height*2;this._style.webkitTransformOrigin="0 0";this._style.webkitTransform="scale(0.5)"}else{g.width=c.width;g.height=c.height}this._element.appendChild(g);this._context=g.getContext("2d");this._tileWidth=h||0;this._tileHeight=f||0;this._image=null;this._data=[[[]]];this._dirty=false;this._tight=false;this.touchEnabled=false;this.collisionData=null;this._listeners.render=null;this.addEventListener("render",function(){if(this._dirty||this._previousOffsetX==null){this._dirty=false;this.redraw(0,0,c.width,c.height)}else{if(this._offsetX!=this._previousOffsetX||this._offsetY!=this._previousOffsetY){if(this._tight){var s=-this._offsetX;var p=-this._offsetY;var u=-this._previousOffsetX;var r=-this._previousOffsetY;var l=s-u+c.width;var j=u-s+c.width;var n=p-r+c.height;var m=r-p+c.height;if(l>this._tileWidth&&j>this._tileWidth&&n>this._tileHeight&&m>this._tileHeight){var q,o,w,v,t,k;if(l<j){q=0;w=u-s;t=l}else{q=s-u;w=0;t=j}if(n<m){o=0;v=r-p;k=n}else{o=p-r;v=0;k=m}if(c._buffer==null){c._buffer=document.createElement("canvas");c._buffer.width=this._context.canvas.width;c._buffer.height=this._context.canvas.height}var i=c._buffer.getContext("2d");if(this._doubledImage){i.clearRect(0,0,t*2,k*2);i.drawImage(this._context.canvas,q*2,o*2,t*2,k*2,0,0,t*2,k*2);i=this._context;i.clearRect(w*2,v*2,t*2,k*2);i.drawImage(c._buffer,0,0,t*2,k*2,w*2,v*2,t*2,k*2)}else{i.clearRect(0,0,t,k);i.drawImage(this._context.canvas,q,o,t,k,0,0,t,k);i=this._context;i.clearRect(w,v,t,k);i.drawImage(c._buffer,0,0,t,k,w,v,t,k)}if(w==0){this.redraw(t,0,c.width-t,c.height)}else{this.redraw(0,0,c.width-t,c.height)}if(v==0){this.redraw(0,k,c.width,c.height-k)}else{this.redraw(0,0,c.width,c.height-k)}}else{this.redraw(0,0,c.width,c.height)}}else{this.redraw(0,0,c.width,c.height)}}}this._previousOffsetX=this._offsetX;this._previousOffsetY=this._offsetY})},loadData:function(k){this._data=Array.prototype.slice.apply(arguments);this._dirty=true;this._tight=false;for(var j=0,g=this._data.length;j<g;j++){var o=0;var k=this._data[j];for(var n=0,h=k.length;n<h;n++){for(var f=0,m=k[n].length;f<m;f++){if(k[n][f]>=0){o++}}}if(o/(k.length*k[0].length)>0.2){this._tight=true;break}}},hitTest:function(p,m){if(p<0||this.width<=p||m<0||this.height<=m){return false}var f=this._image.width;var q=this._image.height;var o=this._tileWidth||f;var k=this._tileHeight||q;p=p/o|0;m=m/k|0;if(this.collisionData!=null){return this.collisionData[m]&&!!this.collisionData[m][p]}else{for(var j=0,l=this._data.length;j<l;j++){var h=this._data[j];var g;if(h[m]!=null&&(g=h[m][p])!=null&&0<=g&&g<(f/o|0)*(q/k|0)){return true}}return false}},image:{get:function(){return this._image},set:function(j){this._image=j;if(b&&c.scale==2){var h=new Surface(j.width*2,j.height*2);var m=this._tileWidth||j.width;var g=this._tileHeight||j.height;var k=j.width/m|0;var i=j.height/g|0;for(var l=0;l<i;l++){for(var f=0;f<k;f++){h.draw(j,f*m,l*g,m,g,f*m*2,l*g*2,m*2,g*2)}}this._doubledImage=h}this._dirty=true}},tileWidth:{get:function(){return this._tileWidth},set:function(f){this._tileWidth=f;this._dirty=true}},tileHeight:{get:function(){return this._tileHeight},set:function(f){this._tileHeight=f;this._dirty=true}},width:{get:function(){return this._tileWidth*this._data[0][0].length}},height:{get:function(){return this._tileHeight*this._data[0].length}},redraw:function(q,p,D,A){if(this._image==null){return}var B,f,o,t,s;if(this._doubledImage){B=this._doubledImage;f=this._tileWidth*2;o=this._tileHeight*2;t=-this._offsetX*2;s=-this._offsetY*2;q*=2;p*=2;D*=2;A*=2}else{B=this._image;f=this._tileWidth;o=this._tileHeight;t=-this._offsetX;s=-this._offsetY}var l=B.width/f|0;var k=B.height/o|0;var j=Math.max((q+t)/f|0,0);var w=Math.max((p+s)/o|0,0);var H=Math.ceil((q+t+D)/f);var m=Math.ceil((p+s+A)/o);var E=B._element;var g=this._context;var h=g.canvas;g.clearRect(q,p,D,A);for(var F=0,G=this._data.length;F<G;F++){var J=this._data[F];var v=Math.min(H,J[0].length);var I=Math.min(m,J.length);for(p=w;p<I;p++){for(q=j;q<v;q++){var C=J[p][q];if(0<=C&&C<l*k){var z=(C%l)*f;var u=(C/l|0)*o;g.drawImage(E,z,u,f,o,q*f-t,p*o-s,f,o)}}}}}});enchant.Group=enchant.Class.create(enchant.Node,{initialize:function(){enchant.Node.call(this);this.childNodes=[];this._x=0;this._y=0},addChild:function(j){this.childNodes.push(j);j.parentNode=this;j.dispatchEvent(new enchant.Event("added"));if(this.scene){var l=new enchant.Event("addedtoscene");j.scene=this.scene;j.dispatchEvent(l);j._updateCoordinate();var h=document.createDocumentFragment();var f;var g=Array.prototype.push;if(j._element){h.appendChild(j._element)}else{if(j.childNodes){f=j.childNodes.slice().reverse();while(f.length){j=f.pop();j.scene=this.scene;j.dispatchEvent(l);if(j._element){h.appendChild(j._element)}else{if(j.childNodes){g.apply(f,j.childNodes.reverse())}}}}}if(!h.childNodes.length){return}var k,i=this;while(i.parentNode){f=i.parentNode.childNodes;f=f.slice(f.indexOf(i)+1).reverse();while(f.length){j=f.pop();if(j._element){k=j._element;break}else{if(j.childNodes){g.apply(f,j.childNodes.slice().reverse())}}}i=i.parentNode}if(k){this.scene._element.insertBefore(h,k)}else{this.scene._element.appendChild(h)}}},insertBefore:function(g,h){var l=this.childNodes.indexOf(h);if(l!=-1){this.childNodes.splice(l,0,g);g.parentNode=this;g.dispatchEvent(new enchant.Event("added"));if(this.scene){var m=new enchant.Event("addedtoscene");g.scene=this.scene;g.dispatchEvent(m);g._updateCoordinate();var n=document.createDocumentFragment();var f;var o=Array.prototype.push;if(g._element){n.appendChild(g._element)}else{if(g.childNodes){f=g.childNodes.slice().reverse();while(f.length){g=f.pop();g.scene=this.scene;g.dispatchEvent(m);if(g._element){n.appendChild(g._element)}else{if(g.childNodes){o.apply(f,g.childNodes.reverse())}}}}}if(!n.childNodes.length){return}var k,j=h;while(j.parentNode){if(l!=null){f=this.childNodes.slice(l+1).reverse();l=null}else{f=j.parentNode.childNodes;f=f.slice(f.indexOf(j)+1).reverse()}while(f.length){g=f.pop();if(g._element){k=g._element;break}else{if(g.childNodes){o.apply(f,g.childNodes.slice().reverse())}}}j=j.parentNode}if(k){this.scene._element.insertBefore(n,k)}else{this.scene._element.appendChild(n)}}}else{this.addChild(g)}},removeChild:function(j){var h=this.childNodes.indexOf(j);if(h!=-1){this.childNodes.splice(h,1)}else{return}j.parentNode=null;j.dispatchEvent(new enchant.Event("removed"));if(this.scene){var k=new enchant.Event("removedfromscene");j.scene=null;j.dispatchEvent(k);if(j._element){this.scene._element.removeChild(j._element)}else{if(j.childNodes){var f=j.childNodes.slice();var g=Array.prototype.push;while(f.length){j=f.pop();j.scene=null;j.dispatchEvent(k);if(j._element){this.scene._element.removeChild(j._element)}else{if(j.childNodes){g.apply(f,j.childNodes)}}}}}}},firstChild:{get:function(){return this.childNodes[0]}},lastChild:{get:function(){return this.childNodes[this.childNodes.length-1]}},_updateCoordinate:function(){if(this.parentNode){this._offsetX=this.parentNode._offsetX+this._x;this._offsetY=this.parentNode._offsetY+this._y}else{this._offsetX=this._x;this._offsetY=this._y}for(var g=0,f=this.childNodes.length;g<f;g++){this.childNodes[g]._updateCoordinate()}}});enchant.Scene=enchant.Class.create(enchant.Group,{initialize:function(){enchant.Group.call(this);this._element=document.createElement("div");this._element.style.position="absolute";this._element.style.overflow="hidden";this._element.style.width=(this.width=c.width)+"px";this._element.style.height=(this.height=c.height)+"px";this._element.style[e+"TransformOrigin"]="0 0";this._element.style[e+"Transform"]="scale("+c.scale+")";this.scene=this;var f=this;if(d){this._element.addEventListener("touchstart",function(k){var j=k.touches;for(var h=0,g=j.length;h<g;h++){k=new enchant.Event("touchstart");k.identifier=j[h].identifier;k._initPosition(j[h].pageX,j[h].pageY);f.dispatchEvent(k)}},false);this._element.addEventListener("touchmove",function(k){var j=k.touches;for(var h=0,g=j.length;h<g;h++){k=new enchant.Event("touchmove");k.identifier=j[h].identifier;k._initPosition(j[h].pageX,j[h].pageY);f.dispatchEvent(k)}},false);this._element.addEventListener("touchend",function(k){var j=k.changedTouches;for(var h=0,g=j.length;h<g;h++){k=new enchant.Event("touchend");k.identifier=j[h].identifier;k._initPosition(j[h].pageX,j[h].pageY);f.dispatchEvent(k)}},false)}else{this._element.addEventListener("mousedown",function(h){var g=h.pageX;var i=h.pageY;h=new enchant.Event("touchstart");h.identifier=c._mousedownID;h._initPosition(g,i);f.dispatchEvent(h);f._mousedown=true},false);c._element.addEventListener("mousemove",function(h){if(!f._mousedown){return}var g=h.pageX;var i=h.pageY;h=new enchant.Event("touchmove");h.identifier=c._mousedownID;h._initPosition(g,i);f.dispatchEvent(h)},false);c._element.addEventListener("mouseup",function(h){if(!f._mousedown){return}var g=h.pageX;var i=h.pageY;h=new enchant.Event("touchend");h.identifier=c._mousedownID;h._initPosition(g,i);f.dispatchEvent(h);f._mousedown=false},false)}},backgroundColor:{get:function(){return this._backgroundColor},set:function(f){this._element.style.backgroundColor=this._backgroundColor=f}},_updateCoordinate:function(){this._offsetX=this._x;this._offsetY=this._y;for(var g=0,f=this.childNodes.length;g<f;g++){this.childNodes[g]._updateCoordinate()}}});var a=["putImageData","drawImage","drawFocusRing","fill","stroke","clearRect","fillRect","strokeRect","fillText","strokeText"];enchant.Surface=enchant.Class.create(enchant.EventTarget,{initialize:function(h,f){enchant.EventTarget.call(this);this.width=h;this.height=f;this.context=null;var i="enchant-surface"+c._surfaceID++;if(document.getCSSCanvasContext){this.context=document.getCSSCanvasContext("2d",i,h,f);this._element=this.context.canvas;this._css="-webkit-canvas("+i+")";var g=this.context}else{if(document.mozSetImageElement){this._element=document.createElement("canvas");this._element.width=h;this._element.height=f;this._css="-moz-element(#"+i+")";this.context=this._element.getContext("2d");document.mozSetImageElement(i,this._element)}else{this._element=document.createElement("canvas");this._element.width=h;this._element.height=f;this._element.style.position="absolute";this.context=this._element.getContext("2d");a.forEach(function(j){var k=this.context[j];this.context[j]=function(){k.apply(this,arguments);this._dirty=true}},this)}}},getPixel:function(f,g){return this.context.getImageData(f,g,1,1).data},setPixel:function(h,m,l,k,f,i){var j=this.context.createImageData(1,1);j.data[0]=l;j.data[1]=k;j.data[2]=f;j.data[3]=i;this.context.putImageData(j,h,m,1,1)},clear:function(){this.context.clearRect(0,0,this.width,this.height)},draw:function(f){arguments[0]=f=f._element;if(arguments.length==1){this.context.drawImage(f,0,0)}else{this.context.drawImage.apply(this.context,arguments)}},clone:function(){var f=new enchant.Surface(this.width,this.height);f.draw(this);return f},toDataURL:function(){var f=this._element.src;if(f){if(f.slice(0,5)=="data:"){return f}else{return this.clone().toDataURL()}}else{return this._element.toDataURL()}}});enchant.Surface.load=function(h){var g=new Image();var f=Object.create(Surface.prototype,{context:{value:null},_css:{value:"url("+h+")"},_element:{value:g}});enchant.EventTarget.call(f);g.src=h;g.onerror=function(){throw new Error("Cannot load an asset: "+g.src)};g.onload=function(){f.width=g.width;f.height=g.height;f.dispatchEvent(new enchant.Event("load"))};return f};enchant.Sound=enchant.Class.create(enchant.EventTarget,{initialize:function(){enchant.EventTarget.call(this);throw new Error("Illegal Constructor");this.duration=0},play:function(){if(this._element){this._element.play()}},pause:function(){if(this._element){this._element.pause()}},stop:function(){this.pause();this.currentTime=0},clone:function(){var f;if(this._element instanceof Audio){f=Object.create(enchant.Sound.prototype,{_element:{value:this._element.cloneNode(false)},duration:{value:this.duration}})}else{f=Object.create(enchant.Sound.prototype)}enchant.EventTarget.call(f);return f},currentTime:{get:function(){return this._element?this._element.currentTime:0},set:function(f){if(this._element){this._element.currentTime=f}}},volume:{get:function(){return this._element?this._element.volume:1},set:function(f){if(this._element){this._element.volume=f}}}});enchant.Sound.load=function(j,g){if(g==null){var f=j.match(/\.\w+$/)[0];if(f){g="audio/"+f.slice(1).toLowerCase()}else{g=""}}g=g.replace("mp3","mpeg");var i=Object.create(enchant.Sound.prototype);enchant.EventTarget.call(i);var h=new Audio();if(!enchant.Sound.enabledInMobileSafari&&e=="webkit"&&d){window.setTimeout(function(){i.dispatchEvent(new enchant.Event("load"))},0)}else{if(h.canPlayType(g)){h.src=j;h.load();h.autoplay=false;h.onerror=function(){throw new Error("Cannot load an asset: "+h.src)};h.addEventListener("canplaythrough",function(){i.duration=h.duration;i.dispatchEvent(new enchant.Event("load"))},false);i._element=h}else{if(g=="audio/mpeg"){var l=document.createElement("embed");var k="enchant-audio"+c._soundID++;l.width=l.height=1;l.name=k;l.src="sound.swf?id="+k+"&src="+j;l.allowscriptaccess="always";l.style.position="absolute";l.style.left="-1px";i.addEventListener("load",function(){Object.defineProperties(l,{currentTime:{get:function(){return l.getCurrentTime()},set:function(m){l.setCurrentTime(m)}},volume:{get:function(){return l.getVolume()},set:function(m){l.setVolume(m)}}});i._element=l;i.duration=l.getDuration()});c._element.appendChild(l);enchant.Sound[k]=i}else{window.setTimeout(function(){i.dispatchEvent(new enchant.Event("load"))},0)}}}return i};enchant.Sound.enabledInMobileSafari=false})();